# CDN

## 1.概念

一种通过互联网互相连接的电脑网络系统，利**用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，来提供高性能**、可扩展性及低成本的网络内容传递给用户。

## 2.作用

1）在性能方面，引入CDN的作用在于：

- 用户收到的内容来自最近的数据中心，**延迟更低，内容加载更快**
- 部分资源请求分配给了CDN，**减少了服务器的负载**

2）在**安全**方面，CDN有助于防御DDoS、MITM等网络攻击：

- 针对DDoS：通过监控分析异常流量，限制其请求频率
- 针对MITM：从源服务器到 CDN 节点到 ISP（Internet Service Provider），全链路 HTTPS 通信

## 3.使用场景

①将自己网站的**静态资源放在CDN上**，比如js、css、图片等。可以将整个项目放在CDN上，完成一键部署。

②**使用第三方的CDN服务**

# 懒加载

## 1.概念

懒加载也叫做**延迟加载、按需加载**，指的是在长网页中延迟加载图片数据，是一种较好的网页性能优化的方式。在比较长的网页或应用中，如果**图片很多，所有的图片都被加载出来**，而用户**只能看到可视窗口的那一部分图片数据**，这样就**浪费了性能**。

如果使用图片的懒加载就可以解决以上问题。在滚动屏幕之前，**可视化区域之外的图片不会进行加载**，在滚动屏幕时才加载。这样使得**网页的加载速度更快**，**减少了服务器的负载**。懒加载适用于图片较多，页面列表较长（长列表）的场景中。

## 2.特点

- **减少无用资源的加载**：使用懒加载明显减少了服务器的压力和流量，同时也减小了浏览器的负担。
- **提升用户体验**: 如果同时加载较多图片，可能需要等待的时间较长，这样影响了用户体验，而使用懒加载就能大大的提高用户体验。
- **防止加载过多图片而影响其他资源文件的加载** ：会影响网站应用的正常使用。

## 3.实现原理

图片的加载是由`src`引起的，当对`src`赋值时，浏览器就会请求图片资源。根据这个原理，使用HTML5 的`data-xxx`属性来储存图片的路径，在需要加载图片的时候，将`data-xxx`中图片的路径赋值给`src`，这样就实现了图片的按需加载，即懒加载。

**注意：**`data-xxx` 中的`xxx`可以自定义，这里一般使用`data-src`来定义。

懒加载的实现重点在于确定用户需要加载哪张图片，在浏览器中，可视区域内的资源就是用户需要的资源。所以当图片出现在可视区域时，获取图片的真实地址并赋值给图片即可。

**原生js实现：**

①`window.innerHeight` 是浏览器**可视区的高度**

②`document.body.scrollTop || document.documentElement.scrollTop` 是浏览器**滚动的过的距离**

③`imgs.offsetTop` 是**元素顶部距离文档顶部的高度（包括滚动条的距离）**

④图片加载条件：`img.offsetTop < window.innerHeight + document.body.scrollTop;`

<img src="https://s1.ax1x.com/2022/05/17/O4A2ZR.png" alt="img" style="zoom: 25%;" />

# 回流（重排）重绘

## 1.回流（重排）

- 页面首次渲染
- 浏览器窗口改变
- 元素位置改变
- 元素大小改变
- 元素内容改变
- 查询某些属性或调用某些方法：如offsetTop
- 添加或删除DOM

## 2.重绘

- 元素的样式改变，**不影响其在文档流中的位置**，如：

  color，background

  border-radius

  visibility

  box-shadow

**触发回流必定重绘，重绘未必回流**

## 3.如何减少

- absolute，fixed使其脱离文档流
- 当需要对一个元素大量操作时，先`display:none`，操作完之后再切换回去
- 避免频繁操作DOM，可以**创建一个文档片段`documentFragment`，在它上面应用所有DOM操作，最后再把它添加到文档中**
- 尽量操作低层级DOM
- 别用table
- 将对DOM的多个读操作和写操作放在一起，而不是穿插进行（浏览器**渲染队列机制**）
- 不频繁操作样式，用切换类名代替

## 4.浏览器渲染队列机制

浏览器会将所有的**回流、重绘的操作放在一个队列**中，当队列中的**操作到了一定的数量或者到了一定的时间间隔**，浏览器就会**对队列进行批处理**。这样就会让**多次的回流、重绘变成一次**回流重绘。

## 5.如何优化动画

将动画的`position`属性设置为`absolute`或者`fixed`，将动画脱离文档流，这样他的回流就不会影响到页面了。

## 6.documentFragment

作为一个轻量版的 Document使用，就像标准的document一样，但它不是真实 DOM 树的一部分，它的变化不会触发 DOM 树的重新渲染。

在**频繁的DOM操作**时，就可以将**DOM元素插入DocumentFragment**，之后**一次性的将所有的子孙节点插入文档中**。和直接操作DOM相比，只会触发一次浏览器渲染，而直接操作DOM可能会触发多次渲染

# 防抖节流

## 1.防抖

**①应用场景**

1）防止多次提交按钮

2）当表单中输入完后会立刻发送服务器请求时，用防抖只获取最后一次输入事件，即输入完之后才发送请求

## 2.节流

**①应用场景**

1）动画场景：避免短时间触发多次动画引起性能问题

2）缩放场景：监控浏览器resize

3）拖拽场景：防止超高频触发位置变动

# 图片优化

1.不用图片，能用CSS代替的就用CSS

2.雪碧图

3.CDN加载，对于移动端，计算出适配屏幕的宽度，然后请求裁剪好的图片

4.使用SVG，尤其对于LOGO类图标

# WebPack